{
	# Enable FrankenPHP with enhanced configuration for PHP 8.4
	frankenphp {
		# Worker mode for better performance - updated for Laravel 12
		worker /app/public/index.php
		# Number of workers (adjust based on your CPU cores)
		worker_count 4
		# Enhanced error handling for development
		request_timeout 30s
	}

	# Enable compression with modern algorithms
	encode zstd gzip

	# Security headers for production readiness
	header {
		# Enhanced security headers for 2025
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		Content-Security-Policy "default-src 'self'"

		# Remove server identification
		-Server
		-X-Powered-By
	}
}

:80, :443 {
	# Document root
	root * /app/public

	# Enable HTTP/3 and modern protocols
	protocols h1 h2 h3

	# Static file handling with aggressive caching
	@static {
		file
		path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.woff *.woff2 *.ttf *.eot *.webp *.avif *.map
	}

	header @static {
		Cache-Control "public, max-age=31536000, immutable"
		Expires "1y"
	}

	# API routes with specific headers
	@api {
		path /api/*
	}

	header @api {
		Cache-Control "no-cache, no-store, must-revalidate"
		Pragma "no-cache"
		Expires "0"
	}

	# PHP handling for Laravel 12
	@php {
		path *.php
		file
	}

	handle @php {
		# Use FrankenPHP's enhanced PHP handler
		php_fastcgi {
			# Enhanced timeout for complex operations
			dial_timeout 5s
			read_timeout 60s
			write_timeout 60s
		}
	}

	# Laravel routing with enhanced fallback
	try_files {path} {path}/ /index.php?{query}

	# Security: Enhanced protection
	@hidden {
		path */.*
		path *.env*
		path composer.*
		path package*.json
	}
	respond @hidden 404

	# Health check endpoint
	handle /health {
		respond "OK" 200
	}

	# Enhanced logging for performance analysis
	log {
		output file /var/log/caddy/access.log {
			roll_size 100MB
			roll_keep 5
		}
		format json
		level INFO
	}

	# Automatic HTTPS with modern TLS configuration
	tls {
		protocols tls1.2 tls1.3
		ciphers TLS_AES_128_GCM_SHA256 TLS_AES_256_GCM_SHA384 TLS_CHACHA20_POLY1305_SHA256
	}
}